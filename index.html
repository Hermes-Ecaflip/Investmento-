<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Investimentos - Jornada do Investidor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
        /* Variáveis de Cores (Paleta Dark Mode) */
        :root {
            --fundo-principal: #1e1e1e;
            --card-fundo: #2a2a2a;
            --texto-claro: #f0f0f0;
            --texto-suave: #aaaaaa;
            --cor-verde: #4caf50;      /* Crescimento, Saldo Total */
            --cor-ciano: #00bcd4;      /* Renda Fixa */
            --cor-laranja: #ff9800;    /* Risco, Ações, Cripto */
            --cor-selic: #2196f3;
            --cor-rf: #03a9f4;
            --cor-cripto: #7900b3;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--fundo-principal);
            color: var(--texto-claro);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        h1 {
            color: var(--cor-verde);
            border-bottom: 2px solid var(--cor-card-fundo);
            padding-bottom: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Estrutura de Cartões (KPIs) */
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background-color: var(--card-fundo);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .kpi-card small {
            display: block;
            color: var(--texto-suave);
            margin-bottom: 5px;
        }

        .kpi-card h2 {
            font-size: 2em;
            margin: 0;
            font-weight: 600;
        }
        
        /* Destaques de Cor para os KPIs */
        .kpi-card.verde { border-left: 5px solid var(--cor-verde); }
        .kpi-card.ciano { border-left: 5px solid var(--cor-ciano); }
        .kpi-card.laranja { border-left: 5px solid var(--cor-laranja); }
        .kpi-card.azul { border-left: 5px solid var(--cor-selic); }

        /* Estrutura de Gráficos e Tabela */
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr; /* 2/3 para Gráficos, 1/3 para Alocação */
            gap: 20px;
        }

        .chart-panel {
            background-color: var(--card-fundo);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* Tabela de Detalhe */
        .asset-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .asset-table th, .asset-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #3a3a3a;
        }

        .asset-table th {
            color: var(--cor-ciano);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
        }

        .asset-table tr:last-child td {
            border-bottom: none;
        }

        .asset-table td:nth-child(4) {
            font-weight: bold;
            color: var(--cor-verde); /* Rentabilidade do mês em destaque */
        }
    </style>
</head>
<body>

<div class="container">
    <h1>🚀 Dashboard de Performance: Jornada do Investidor</h1>

    <div class="kpi-container">
        <div class="kpi-card verde">
            <small>SALDO FINAL (Out/2025)</small>
            <h2 id="kpi-saldo">R$ 3.942,96</h2>
        </div>
        <div class="kpi-card ciano">
            <small>LUCRO TOTAL (Renda)</small>
            <h2 id="kpi-lucro">R$ 689,71</h2>
        </div>
        <div class="kpi-card laranja">
            <small>RENTABILIDADE ACUMULADA</small>
            <h2 id="kpi-rentabilidade">21,20%</h2>
            <p style="margin: 0; font-size: 0.8em; color: var(--texto-suave);">*Sobre o Aportado</p>
        </div>
        <div class="kpi-card azul">
            <small>RENT. MÉDIA MENSAL</small>
            <h2 id="kpi-media">2,08%</h2>
        </div>
    </div>

    <div class="main-grid">
        <div>
            <div class="chart-panel">
                <h3>Evolução Patrimonial Total</h3>
                <canvas id="grafico-saldo-total" height="150"></canvas>
            </div>

            <div class="chart-panel">
                <h3>Aportes Mensais (Consistência)</h3>
                <canvas id="grafico-aportes" height="150"></canvas>
            </div>
        </div>

        <div>
            <div class="chart-panel">
                <h3>Alocação Atual (Out/2025)</h3>
                <canvas id="grafico-alocacao" height="250"></canvas>
            </div>
            
            <div class="chart-panel">
                <h3>Performance por Ativo (Out/2025)</h3>
                <table class="asset-table">
                    <thead>
                        <tr>
                            <th>Ativo</th>
                            <th>Saldo (R$)</th>
                            <th>% Total</th>
                            <th>Rent. Mês (%)</th>
                        </tr>
                    </thead>
                    <tbody id="asset-details">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. DADOS DA PLANILHA (Formato mais fácil para processamento)
    const dataPlanilha = [
        // Mês/Ano;CDB (R$);Tesouro Selic (R$);Fundos RF (R$);Ações (R$);Cripto (R$);Total Investido (R$);Rentabilidade Mês (%);Saldo Final (R$)
        ["Jan/2021", 500.25, 300.10, 200.50, 150.75, 50.20, 1201.80, 0.5, 1207.81],
        ["Fev/2021", 520.40, 310.25, 205.35, 160.10, 55.40, 1251.50, 0.6, 1258.51],
        ["Mar/2021", 540.10, 320.55, 210.50, 170.75, 60.10, 1301.95, 0.8, 1311.30],
        ["Abr/2021", 560.30, 330.15, 215.75, 180.25, 62.50, 1348.95, 0.7, 1358.39],
        ["Mai/2021", 580.15, 340.25, 220.10, 190.50, 65.30, 1395.30, 0.6, 1403.57],
        ["Jun/2021", 600.20, 350.30, 225.50, 200.75, 68.50, 1444.25, 0.9, 1457.34],
        ["Jul/2021", 620.50, 360.40, 230.60, 210.40, 70.25, 1492.15, 0.8, 1503.94],
        ["Ago/2021", 640.10, 370.55, 235.75, 220.50, 73.10, 1539.99, 0.7, 1550.80],
        ["Set/2021", 660.25, 380.30, 240.50, 230.25, 75.40, 1586.70, 0.6, 1596.21],
        ["Out/2021", 680.50, 390.10, 245.75, 240.50, 78.10, 1634.95, 0.5, 1643.07],
        ["Nov/2021", 700.20, 400.25, 250.50, 250.75, 80.50, 1681.70, 0.6, 1691.79],
        ["Dez/2021", 720.35, 410.15, 255.25, 260.50, 82.75, 1728.95, 0.7, 1740.06],
        ["Jan/2022", 740.10, 420.40, 260.50, 270.25, 85.20, 1776.45, 0.6, 1787.12],
        ["Fev/2022", 760.25, 430.25, 265.75, 280.50, 88.10, 1824.85, 0.7, 1837.74],
        ["Mar/2022", 780.50, 440.10, 270.50, 290.75, 90.50, 1872.35, 0.8, 1887.90],
        ["Abr/2022", 800.15, 450.30, 275.25, 300.10, 93.20, 1918.95, 0.7, 1932.44],
        ["Mai/2022", 820.40, 460.50, 280.50, 310.25, 95.50, 1966.15, 0.6, 1977.06],
        ["Jun/2022", 840.25, 470.25, 285.75, 320.50, 98.20, 2014.95, 0.9, 2033.91],
        ["Jul/2022", 860.50, 480.40, 290.50, 330.25, 100.50, 2062.15, 0.8, 2078.83],
        ["Ago/2022", 880.10, 490.55, 295.75, 340.50, 103.25, 2109.15, 0.7, 2124.48],
        ["Set/2022", 900.25, 500.30, 300.50, 350.75, 105.50, 2156.30, 0.6, 2169.58],
        ["Out/2022", 920.50, 510.10, 305.75, 360.50, 108.10, 2304.95, 0.5, 2316.48],
        ["Nov/2022", 940.20, 520.25, 310.50, 370.75, 110.50, 2252.20, 0.6, 2265.61],
        ["Dez/2022", 960.35, 530.15, 315.25, 380.50, 112.75, 2298.95, 0.7, 2315.06],
        ["Jan/2023", 980.10, 540.40, 320.50, 390.25, 115.20, 2346.45, 0.6, 2360.08],
        ["Fev/2023", 1000.25, 550.25, 325.75, 400.50, 118.10, 2394.85, 0.7, 2411.51],
        ["Mar/2023", 1020.50, 560.10, 330.50, 410.75, 120.50, 2442.35, 0.8, 2461.10],
        ["Abr/2023", 1040.15, 570.30, 335.25, 420.10, 123.20, 2488.95, 0.7, 2506.92],
        ["Mai/2023", 1060.40, 580.50, 340.50, 430.25, 125.50, 2536.15, 0.6, 2551.38],
        ["Jun/2023", 1080.25, 590.25, 345.75, 440.50, 128.20, 2584.95, 0.9, 2611.61],
        ["Jul/2023", 1100.50, 600.40, 350.50, 450.25, 130.50, 2631.15, 0.8, 2652.70],
        ["Ago/2023", 1120.10, 610.55, 355.75, 460.50, 133.25, 2679.15, 0.7, 2698.70],
        ["Set/2023", 1140.25, 620.30, 360.50, 470.75, 135.50, 2726.30, 0.6, 2742.77],
        ["Out/2023", 1160.50, 630.10, 365.75, 480.50, 138.10, 2774.95, 0.5, 2788.82],
        ["Nov/2023", 1180.20, 640.25, 370.50, 490.75, 140.50, 2822.20, 0.6, 2839.53],
        ["Dez/2023", 1200.35, 650.15, 375.25, 500.50, 142.75, 2868.95, 0.7, 2889.88],
        ["Jan/2024", 1220.10, 660.40, 380.50, 510.25, 145.20, 2916.45, 0.6, 2933.75],
        ["Fev/2024", 1240.25, 670.25, 385.75, 520.50, 148.10, 2964.85, 0.7, 2985.34],
        ["Mar/2024", 1260.50, 680.10, 390.50, 530.75, 150.50, 3012.35, 0.8, 3036.25],
        ["Abr/2024", 1280.15, 690.30, 395.25, 540.10, 153.20, 3058.95, 0.7, 3079.02],
        ["Mai/2024", 1300.40, 700.50, 400.50, 550.25, 155.50, 3106.15, 0.6, 3124.79],
        ["Jun/2024", 1320.25, 710.25, 405.75, 560.50, 158.20, 3154.95, 0.9, 3183.39],
        ["Jul/2024", 1340.50, 720.40, 410.50, 570.25, 160.50, 3201.15, 0.8, 3226.96],
        ["Ago/2024", 1360.10, 730.55, 415.75, 580.50, 163.25, 3249.15, 0.7, 3272.92],
        ["Set/2024", 1380.25, 740.30, 420.50, 590.75, 165.50, 3296.30, 0.6, 3316.08],
        ["Out/2024", 1400.50, 750.10, 425.75, 600.50, 168.10, 3344.95, 0.5, 3361.67],
        ["Nov/2024", 1420.20, 760.25, 430.50, 610.75, 170.50, 3392.20, 0.6, 3412.75],
        ["Dez/2024", 1440.35, 770.15, 435.25, 620.50, 172.75, 3438.95, 0.7, 3462.22],
        ["Jan/2025", 1460.10, 780.40, 440.50, 630.25, 175.20, 3486.45, 0.6, 3507.74],
        ["Fev/2025", 1480.25, 790.25, 445.75, 640.50, 178.10, 3534.85, 0.7, 3559.34],
        ["Mar/2025", 1500.50, 800.10, 450.50, 650.75, 180.50, 3582.35, 0.8, 3611.10],
        ["Abr/2025", 1520.15, 810.30, 455.25, 660.10, 183.20, 3628.95, 0.7, 3654.01],
        ["Mai/2025", 1540.40, 820.50, 460.50, 670.25, 185.50, 3676.15, 0.6, 3697.82],
        ["Jun/2025", 1560.25, 830.25, 465.75, 680.50, 188.20, 3724.95, 0.9, 3758.19],
        ["Jul/2025", 1580.50, 840.40, 470.50, 690.25, 190.50, 3771.15, 0.8, 3801.72],
        ["Ago/2025", 1600.10, 850.55, 475.75, 700.50, 193.25, 3819.15, 0.7, 3845.48],
        ["Set/2025", 1620.25, 860.30, 480.50, 710.75, 195.50, 3866.30, 0.6, 3890.50],
        ["Out/2025", 1640.50, 870.10, 485.75, 720.50, 198.10, 3914.95, 0.7, 3942.96] 
    ];

    const labels = dataPlanilha.map(row => row[0]);
    const saldosFinais = dataPlanilha.map(row => row[8]);

    // 2. FUNÇÃO PARA CALCULAR APORTES MENSAIS
    function calcularAportes(data) {
        const aportes = [];
        let saldoAnterior = 0;

        for (let i = 0; i < data.length; i++) {
            const totalInvestido = data[i][6]; // Coluna Total Investido (após aporte, antes da rentabilidade)
            const saldoFinalAnterior = (i === 0) ? data[i][6] : data[i-1][8]; // Saldo Final do mês anterior ou Invest. Inicial

            // Aporte é a diferença entre o Total Investido (mês atual) e o Saldo Final (mês anterior)
            const aporte = totalInvestido - saldoFinalAnterior;
            aportes.push(Math.max(0, parseFloat(aporte.toFixed(2)))); // Garante que não apareçam valores negativos por arredondamento
            saldoAnterior = data[i][8];
        }
        return aportes;
    }
    const aportesMensais = calcularAportes(dataPlanilha);

    // 3. CONFIGURAÇÃO E CRIAÇÃO DOS GRÁFICOS

    // A. Gráfico de Evolução do Saldo Total
    const ctxSaldo = document.getElementById('grafico-saldo-total').getContext('2d');
    new Chart(ctxSaldo, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Saldo Final (R$)',
                data: saldosFinais,
                backgroundColor: 'rgba(76, 175, 80, 0.3)', // Cor Verde com transparência
                borderColor: 'var(--cor-verde)',
                borderWidth: 2,
                fill: true,
                tension: 0.3,
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: false, grid: { color: '#3a3a3a' }, ticks: { color: 'var(--texto-claro)' } },
                x: { grid: { color: '#3a3a3a' }, ticks: { color: 'var(--texto-claro)', maxTicksLimit: 12 } }
            }
        }
    });

    // B. Gráfico de Aportes Mensais
    const ctxAportes = document.getElementById('grafico-aportes').getContext('2d');
    new Chart(ctxAportes, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Aporte (R$)',
                data: aportesMensais,
                backgroundColor: 'var(--cor-selic)',
                hoverBackgroundColor: 'var(--cor-ciano)',
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { color: '#3a3a3a' }, ticks: { color: 'var(--texto-claro)' } },
                x: { grid: { display: false }, ticks: { color: 'var(--texto-claro)', maxTicksLimit: 12 } }
            }
        }
    });

    // C. Gráfico de Alocação Atual (Donut)
    const ultimoMes = dataPlanilha[dataPlanilha.length - 1];
    const ativos = ["CDB", "Tesouro Selic", "Fundos RF", "Ações", "Cripto"];
    const saldosAtivos = ultimoMes.slice(1, 6); // Posições 1 a 5 da linha de dados

    const ctxAlocacao = document.getElementById('grafico-alocacao').getContext('2d');
    new Chart(ctxAlocacao, {
        type: 'doughnut',
        data: {
            labels: ativos,
            datasets: [{
                data: saldosAtivos,
                backgroundColor: [
                    'var(--cor-ciano)',
                    'var(--cor-selic)',
                    'var(--cor-rf)',
                    'var(--cor-laranja)',
                    'var(--cor-cripto)'
                ],
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { color: 'var(--texto-claro)' } },
                title: { display: false }
            }
        }
    });

    // 4. PREENCHIMENTO DA TABELA DE DETALHE

    function preencherTabela() {
        const tbody = document.getElementById('asset-details');
        tbody.innerHTML = '';

        const totalGeral = ultimoMes[8]; // Saldo Final
        const ativosData = [
            { nome: "CDB", saldo: ultimoMes[1], rentabilidade: "0,7" },
            { nome: "Tesouro Selic", saldo: ultimoMes[2], rentabilidade: "0,7" },
            { nome: "Fundos RF", saldo: ultimoMes[3], rentabilidade: "0,7" },
            { nome: "Ações", saldo: ultimoMes[4], rentabilidade: "0,7" }, // Ajustado para 0,7% como exemplo
            { nome: "Cripto", saldo: ultimoMes[5], rentabilidade: "0,7" }  // Ajustado para 0,7% como exemplo
        ];
        
        // Replicando a lógica de rentabilidade da planilha (coluna 7) para Ações e Cripto
        const rentabilidadeGeral = ultimoMes[7]; // 0.7
        ativosData[3].rentabilidade = rentabilidadeGeral.toFixed(1); // Ações
        ativosData[4].rentabilidade = rentabilidadeGeral.toFixed(1); // Cripto

        ativosData.forEach(ativo => {
            const porcentagem = ((ativo.saldo / totalGeral) * 100).toFixed(2);
            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${ativo.nome}</td>
                <td>R$ ${ativo.saldo.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                <td>${porcentagem}%</td>
                <td>+${ativo.rentabilidade}%</td>
            `;
        });
    }

    preencherTabela();

</script>

</body>
</html>
